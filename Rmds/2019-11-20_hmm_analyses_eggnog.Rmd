---
title: "HMM analyses using eggNOG data"
author: "LJM"
date: "`r Sys.Date()`"
link-citations: true
bibliography: bibliography.bib
biblio-style: "alpha" #https://www.overleaf.com/learn/latex/Bibtex_bibliography_styles
#csl: "../uppsala-universitet-institutionen-for-biologisk-grundutbildning.csl"
documentclass: report
output:
  bookdown::html_document2:
    highlight: tango
    theme: journal
    split_by: none # only generate a single output page
    self_contained: TRUE
    toc: yes
    toc_float: 
      collapsed: TRUE
      smooth_scroll: TRUE
      print: FALSE
    code_folding: show
    number_sections: TRUE
    code_download: TRUE
  html_document: 
    toc: TRUE
    toc_float: TRUE
    code_folding: show
    highlight: tango
    number_sections: TRUE
    self_contained: TRUE
    smart: TRUE # To be figured out when this is useful
    theme: journal
  pdf_document:
    toc: TRUE
    toc_depth: 2
    highlight: tango # This appears to be the same as default
    number_sections: TRUE
  bookdown::pdf_document2:
    keep_tex: no
    latex_engine: xelatex
    #highlight: pygments #Other options: default, tango, kate, monochrome, espresso, zenburn, haddock, and textmate
    #theme: spacelab
    pandoc_args: ["--variable", "subparagraph",
                "--top-level-division","chapter"] # Could also be section 
---

# Searching with HMMs

```{bash eval=FALSE, include=TRUE}
#ml bioinfo-tools hmmer/3.2.1
DATA="../analyses/HMM_scan_using_eggNOG_HMMs/eggNOG_data/HMMs/"
HMMer_OUTPUT_DIR="../analyses/HMM_scan_using_eggNOG_HMMs/hmmsearch_out_viruses/"
fOTUproteoms_DIR="../analyses/fOTU_proteomes/"


read -r -a fOTUproteoms <<< $( find $fOTUproteoms_DIR -name "*.faa" -and -type f -print0 | xargs -0 echo )

for TAXID in $DATA*/ ; do
  TAXID_NO=$(echo "$TAXID" | awk -F "/" '{print $(NF-1)}')
  read -r -a HMMs <<< $( find $TAXID -name "*.hmm" -and -type f -print0 | xargs -0 echo )
  for HMM in "${HMMs[@]}"; do
    HMM_FILE=$(echo $(basename "$HMM"))
    HMM_VARIANT=$(echo $(basename "$HMM") | awk -F "." '{print $1}')
    for fOTUproteom in "${fOTUproteoms[@]}"; do
      fOTU_FILE=$(echo $(basename "$fOTUproteom"))
      fOTU=$(echo $(basename "$fOTUproteom") | awk -F "." '{print $1}')
      #echo $fOTUproteom
      hmmsearch --cpu 4 --noali -E 0.01 --domE 0.01 --pfamtblout "$HMMer_OUTPUT_DIR""$TAXID_NO""_""$HMM_VARIANT""_""$fOTU"".pfamtbl.out" "$HMM" "$fOTUproteom"
      #hmmsearch --cpu 4 --noali -E 0.01 --domE 0.01 --incE 0.001 --incdomE 0.001 --notextw -o "$HMMer_OUTPUT_DIR""$TAXID_NO""_""$HMM_VARIANT"".out" --pfamtblout "$HMMer_OUTPUT_DIR""$TAXID_NO""_""$HMM_VARIANT"".pfamtbl.out" "$HMM" "$fOTUproteom"
      #hmmsearch --cpu 3 --noali -E 0.01 --domE 0.01 --incE 0.001 --incdomE 0.001 --notextw -o "$HMMer_OUTPUT_DIR""$TAXID_NO""_""$HMM_VARIANT"".out" --tblout "$HMMer_OUTPUT_DIR""$TAXID_NO""_""$HMM_VARIANT"".tbl.out" "$HMM" "$fOTUproteom"
      #hmmsearch --cpu 3 --noali -E 0.01 --domE 0.01 --incE 0.001 --incdomE 0.001 --notextw --tblout "$HMMer_OUTPUT_DIR""$TAXID_NO""_""$HMM_VARIANT"".tbl.out" "$HMM" "$fOTUproteom"
    done
  done
done
```



# Utility script for changing delimiters


```{bash}
SCRIPT="../scripts/eggNOGdeliminator.awk"
TSV_FILE="Fuselloviridae_10474_annotations.tsv"
cat $TSV_FILE | awk -v delimiter=";" -v last_col="4" -f $SCRIPT
```
















# Session info

```{r}
sessionInfo()
```


# References
